<!DOCTYPE html>
<html lang="en" id="rootHtml">
<head>
<meta charset="UTF-8">
<title>Vehicle Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    :root {
        --bg: #0d0d0d;
        --card: #1c1c1c;
        --text: #e6e6e6;
        --muted: #999;
        --accent: #1b8cff;
        --border: #303030;
        --waiting: #4CAF50;
        --loading: #1b8cff;
        --ready:   #46d369;
    }

    /* =========================================================
       NEW, RELIABLE FLASHING METHOD (PSEUDO-ELEMENT)
       ========================================================= */

    body {
        margin: 0;
        background-color: var(--bg); /* A solid, non-animated background */
        font-family: Arial, sans-serif;
        padding: 20px;
        text-align: center;
        color: var(--text);
        position: relative; /* Needed to position the pseudo-element correctly */
        z-index: 1;
    }

    /* This creates a virtual layer that sits behind all of your content */
    body::before {
        content: '';
        position: fixed; /* Covers the entire screen */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #ffb300; /* This is the flash color */
        z-index: -1; /* Puts it behind the text and cards */
        opacity: 0;  /* It starts completely invisible */
    }

    /* When the body gets the .flash-amber class, we animate the ::before layer */
    body.flash-amber::before {
        -webkit-animation: flashOpacity 1s infinite;
        animation: flashOpacity 1s infinite;
    }

    /* This animation is very reliable as it only changes opacity */
    @-webkit-keyframes flashOpacity {
        0%, 100% { opacity: 0; }
        50%      { opacity: 1; }
    }
    @keyframes flashOpacity {
        0%, 100% { opacity: 0; }
        50%      { opacity: 1; }
    }


    /* (All other CSS remains the same) */
    .title { font-size: 32px; font-weight: bold; margin-bottom: 6px; color: var(--accent); }
    .sub { font-size: 16px; opacity: 0.8; margin-bottom: 20px; }
    .lang-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
    .tile { padding: 10px 18px; border-radius: 10px; background: var(--card); border: 2px solid var(--border); cursor: pointer; user-select: none; font-size: 16px; color: var(--text); transition: 0.2s; }
    .tile:hover { border-color: var(--accent); }
    .tile.active { border-color: var(--accent); font-weight: bold; }
    .card { background: var(--card); padding: 25px; border-radius: 16px; border: 1px solid var(--border); text-align: left; max-width: 600px; margin: 0 auto 18px auto; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
    .reg { font-size: 26px; font-weight: bold; margin-bottom: 10px; color: var(--accent); text-align: center; }
    .label { font-size: 15px; color: var(--muted); margin-bottom: 3px; margin-top: 12px; }
    .status { font-size: 23px; font-weight: bold; margin-top: 6px; padding: 10px 0; text-align: center; border-radius: 10px; }
    .waiting { color: var(--waiting); }
    .loading { color: var(--loading); }
    .ready   { color: var(--ready); }
    .note { margin-top: 14px; font-size: 15px; opacity: 0.9; text-align: center; color: var(--text); }
</style>
</head>

<body>

<!-- NO CHANGES TO HTML -->
<div id="title" class="title">Vehicle Status</div>
<div id="subtitle" class="sub">Updates refresh every few seconds</div>
<div class="lang-row" id="langRow">
    <div class="tile active" data-lang="en">üá¨üáß English</div>
    <div class="tile" data-lang="pl">üáµüá± Polski</div>
    <div class="tile" data-lang="ro">üá∑üá¥ Rom√¢nƒÉ</div>
    <div class="tile" data-lang="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</div>
    <div class="tile" data-lang="cs">üá®üáø ƒåe≈°tina</div>
</div>
<div class="card">
    <div id="reg" class="reg"></div>
    <div id="poLabel" class="label"></div>
    <div id="poValue"></div>
    <div id="pagerLabel" class="label"></div>
    <div id="pagerValue"></div>
    <div id="statusLabel" class="label"></div>
    <div id="statusValue" class="status waiting"></div>
    <div id="noteText" class="note"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// NO CHANGES TO JAVASCRIPT - IT WAS ALREADY CORRECT
const db = supabase.createClient("https://splcucorowqjxeeseolq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNwbGN1Y29yb3dxanhlZXNlb2xxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNTExMjUsImV4cCI6MjA3ODYyNzEyNX0.R-Fm04UtBOr9OBWHnS1fhk6SnfSm7f3ZrFrQdzO1Q4Y");
function extractVehicleId(){const raw=window.location.search.replace("?","").trim();const p=new URLSearchParams(window.location.search);if(p.get("uid"))return p.get("uid");for(const[key,val]of p.entries()){if(/^[0-9a-fA-F-]{30,}$/.test(val))return val}if(/^[0-9a-fA-F-]{30,}$/.test(raw))return raw;return null}
async function loadVehicle(){let vehicleId=extractVehicleId();if(!vehicleId){const{data}=await db.from("vehicles").select("id").order("created_at",{ascending:false}).limit(1);if(data?.[0]){vehicleId=data[0].id}else{return}}const{data}=await db.from("vehicles").select("*").eq("id",vehicleId).single();if(!data)return;document.getElementById("reg").textContent=data.registration;document.getElementById("poValue").textContent=data.po_ref||"-";document.getElementById("pagerValue").textContent=data.pager_number||"-";currentStatus=data.status;setLang(currentLang)}
const T={en:{title:"Vehicle Status",subtitle:"Updates refresh every few seconds",po:"PO / Reference",pager:"Pager Number",status:"Current Status",waiting:"Waiting in lorry park",loading:"Proceed to loading area",ready:"Proceed to gatehouse",note:"Please remain in your cab unless instructed."}};let currentLang="en";let currentStatus="waiting";
function setLang(lang){const L=T[lang];const st=document.getElementById("statusValue");st.className="status";if(currentStatus==="waiting"){st.textContent=L.waiting;st.classList.add("waiting");document.body.classList.remove("flash-amber")}if(currentStatus==="notified"){st.textContent=L.loading;st.classList.add("loading");document.body.classList.add("flash-amber")}if(currentStatus==="released"){st.textContent=L.ready;st.classList.add("ready");document.body.classList.remove("flash-amber")}document.getElementById("poLabel").textContent=L.po;document.getElementById("pagerLabel").textContent=L.pager;document.getElementById("statusLabel").textContent=L.status;document.getElementById("noteText").textContent=L.note}
loadVehicle();setInterval(loadVehicle,8000);
</script>

</body>
</html>

